"use strict";function onGoogleSignInFailure(e){console.log(e)}function renderButton(){gapi.signin2.render("g-signin2",{scope:"profile",width:120,height:36,longtitle:!1,theme:"dark",onsuccess:onGoogleSignIn,onfailure:onGoogleSignInFailure})}function onGoogleSignIn(a){console.log("Google Auth Response",a);var n=firebase.auth().onAuthStateChanged(function(e){if(n(),isUserEqual(a,e))console.log("User already signed-in Firebase.");else{var t=firebase.auth.GoogleAuthProvider.credential(a.getAuthResponse().id_token);firebase.auth().signInWithCredential(t).catch(function(e){var t=e.code;e.message,e.email,e.credential;"auth/account-exists-with-different-credential"===t?alert("You have already signed up with a different auth provider for that email."):console.error(e)})}}),e=a.getBasicProfile();[[".rpEmail",e.getEmail()],[".rpName",e.getName()]].forEach(function(e){applyDOM(e[0],e[1])}),removeClass(".isLogin","hide"),addClass(".isNotLogin","hide"),[[".registName",e.getName()],[".registEmail",e.getEmail()],[".contactName",e.getName()],[".contactEmail",e.getEmail()]].forEach(function(t){var e=document.querySelectorAll(t[0]);0<e.length&&[].map.call(e,function(e){return e.value=t[1],e})})}function getName(e){switch(e.provider){case"password":return e.password.email.replace(/@.*/,"");case"twitter":return e.twitter.displayName;case"facebook":return e.facebook.displayName;case"google":return e.google.displayName}}function getEmail(e){switch(e.provider){case"password":return e.password.email;case"twitter":return e.twitter.email;case"facebook":return e.facebook.email;case"google":return e.google.email}}function applyDOM(e,t){if(document.querySelector(e)){var a=document.querySelectorAll(e);Array.prototype.map.call(a,function(e){e.innerHTML=t})}}function addClass(e,t){if(document.querySelector(e)){var a=document.querySelectorAll(e);Array.prototype.map.call(a,function(e){e.classList.add(t)})}}function removeClass(e,t){if(document.querySelector(e)){var a=document.querySelectorAll(e);Array.prototype.map.call(a,function(e){e.classList.remove(t)})}}function getFormNode(e){return"FORM"!==e.tagName?getFormNode(e.parentNode):e}function getUrlVars(){for(var e={},t=location.search.substring(1).split("&"),a=0;a<t.length;a++){var n=t[a].search(/=/),r="";-1!=n&&(r=t[a].slice(0,n));var o=t[a].slice(t[a].indexOf("=",0)+1);""!=r&&(e[r]=decodeURI(o))}return e}function isUserEqual(e,t){if(t)for(var a=t.providerData,n=0;n<a.length;n++)if(a[n].providerId===firebase.auth.GoogleAuthProvider.PROVIDER_ID&&a[n].uid===e.getBasicProfile().getId())return!0;return!1}function handleSignOut(){gapi.auth2.getAuthInstance().signOut().then(function(){firebase.auth().signOut()})}function initApp(){firebase.auth().onAuthStateChanged(function(e){if(e){e.displayName,e.email,e.emailVerified,e.photoURL,e.isAnonymous;var t=e.uid;e.refreshToken,e.providerData;firebase.database().ref("users/"+t).set({providerData:e.providerData,timestamp:firebase.database.ServerValue.TIMESTAMP})}})}function initFirebase(){firebase.initializeApp({apiKey:"AIzaSyBloVL747jiEoKZN9RBEoJpaJn1Ex1Q_U8",authDomain:"family1st-6275f.firebaseapp.com",databaseURL:"https://family1st-6275f.firebaseio.com",storageBucket:"family1st-6275f.appspot.com"})}function sendEmailAddress(e){var t={email:getFormNode(e.target).querySelector('input[name="email"]')};""===t.email.value&&document.querySelector(".mdl-js-snackbar").MaterialSnackbar.showSnackbar({message:"メールアドレスが記入されていません！"});""!==t.email.value&&t.email.checkValidity()&&sendValGuerstRegist(t)}function sendValGuerstRegist(e){document.querySelector(".mdl-js-snackbar").MaterialSnackbar.showSnackbar({message:"送信中です"}),axios.post(EmailRegistURL,{email:e.email.value}).then(function(e){"function"==typeof goog_report_conversion&&goog_report_conversion(window.location.href),console.log(e),addClass("#registguestform","hide"),removeClass("#registguestformsuccessalert","hide"),localStorage.setItem("registeredGuestMember","true"),document.querySelector(".mdl-js-snackbar").MaterialSnackbar.showSnackbar({message:"メールアドレスの登録が完了しました。"})}).catch(function(e){console.log(e)})}function sendValContactForm(e){document.querySelector(".mdl-js-snackbar").MaterialSnackbar.showSnackbar({message:"送信中です"});var t={};e.map(function(e){t[e.key]=e.elm.value}),console.log(t),axios.post(ContactFormURL,t).then(function(e){console.log(e),addClass("#contactform","hide"),removeClass("#contactformsuccessalert","hide"),document.querySelector(".mdl-js-snackbar").MaterialSnackbar.showSnackbar({message:"送信が完了しました"})}).catch(function(e){console.log(e)})}document.addEventListener("DOMContentLoaded",function(e){initFirebase(),initApp()}),document.addEventListener("DOMContentLoaded",function(e){var n=[["name","contactName","input"],["email","contactEmail","input"],["message","contactMessage","textarea"]],t=n.map(function(e){return document.querySelectorAll("."+e[1])}).filter(function(e){if(0!==e.length)return!0}).reduce(function(e,t){var a=Array.prototype.slice.call(e),n=Array.prototype.slice.call(t);return a.concat(n)},[]);Array.prototype.map.call(t,function(t){["keyup","blur"].map(function(e){t.addEventListener(e,function(e){null!==t&&t.checkValidity()?(t.parentElement.classList.remove("has-warning"),t.classList.remove("form-control-warning")):(t.parentElement.classList.add("has-warning"),t.classList.add("form-control-warning"))})})});var a=document.querySelector(".msgSubmitBtn");null!==a&&a.addEventListener("click",function(t){var e=n.map(function(e){return{key:e[0],elm:getFormNode(t.target).querySelector(e[2]+'[name="'+e[1]+'"]')}}),a=e.map(function(e){return e.elm.checkValidity()}).filter(function(e){if(!0!==e)return!0});console.log(a),0===a.length&&sendValContactForm(e),t.preventDefault()},!1);var r=document.querySelectorAll(".guestRegistSubmitBtn");[].map.call(r,function(e){return null!==e&&e.addEventListener("click",function(e){sendEmailAddress(e),e.preventDefault()},!1),e});var o=document.querySelectorAll(".registMailForm");Array.prototype.map.call(o,function(e){var t=e.querySelector('input[name="email"]');return null!==t&&t.addEventListener("keydown",function(e){13==e.keyCode&&(e.preventDefault(),sendEmailAddress(e))},!1),e})});var EmailRegistURL="https://family1st-regist.appspot.com/regist/guest",ContactFormURL="https://ninkigumi-contact.appspot.com/send";